<!DOCTYPE html>
<html>
<head>
    <title>Create Test</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        // Функция для получения CSRF токена из cookies
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = jQuery.trim(cookies[i]);
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        const csrftoken = getCookie('csrftoken');

        function submitTest() {
            $.ajax({
                url: '',
                type: 'post',
                headers: {'X-CSRFToken': csrftoken},
                data: $('#testForm').serialize() + '&test_form=1',
                success: function(data) {
                    alert('Test created with ID ' + data.testId);
                    $('#questionForm').show();
                    $('#questionForm input[name="question-test"]').val(data.testId); // Убедитесь, что у вас правильно названы поля
                }
            });
        }

        function submitQuestion() {
            $.ajax({
                url: '',
                type: 'post',
                headers: {'X-CSRFToken': csrftoken},
                data: $('#questionForm').serialize() + '&question_form=1',
                success: function(data) {
                    alert('Question added with ID ' + data.questionId);
                    $('#answerForm').show();
                    $('#answerForm input[name="answer-question"]').val(data.questionId); // Убедитесь, что у вас правильно названы поля
                }
            });
        }

        function submitAnswer() {
            $.ajax({
                url: '',
                type: 'post',
                headers: {'X-CSRFToken': csrftoken},
                data: $('#answerForm').serialize() + '&answer_form=1',
                success: function(data) {
                    alert('Answer added successfully');
                }
            });
        }
    </script>
</head>
<body>
    <h1>Create a New Test</h1>
    <form id="testForm">
         {% csrf_token %}
        {{ test_form.as_p }}
        <button type="button" onclick="submitTest()">Create Test</button>
    </form>

    <h2>Add a Question</h2>
    <form id="questionForm" style="display:none;">
         {% csrf_token %}
        {{ question_form.as_p }}
        <button type="button" onclick="submitQuestion()">Add Question</button>
    </form>

    <h3>Add an Answer</h3>
    <form id="answerForm" style="display:none;">
         {% csrf_token %}
        {{ answer_form.as_p }}
        <button type="button" onclick="submitAnswer()">Add Answer</button>
    </form>

    <script>
    function submitTest() {
        $.ajax({
            url: '',
            type: 'post',
            data: $('#testForm').serialize() + '&test_form=1',
            success: function(data) {
                alert('Test created with ID ' + data.testId);
                $('#questionForm').show();
                $('#questionForm input[name="question-test"]').val(data.testId);
            }
        });
    }

    function submitQuestion() {
        $.ajax({
            url: '',
            type: 'post',
            data: $('#questionForm').serialize() + '&question_form=1',
            success: function(data) {
                alert('Question added with ID ' + data.questionId);
                $('#answerForm').show();
                $('#answerForm input[name="answer-question"]').val(data.questionId);
            }
        });
    }

    function submitAnswer() {
        $.ajax({
            url: '',
            type: 'post',
            data: $('#answerForm').serialize() + '&answer_form=1',
            success: function(data) {
                alert('Answer added successfully');
            }
        });
    }
    </script>
</body>
</html>
